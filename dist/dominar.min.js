/* dominar.js - Copyright 2015 Gary Green. Licensed under the Apache License, Version 2.0 */!function(t){"undefined"!=typeof exports?module.exports=t:window.Dominar=t(jQuery,Validator)}(function(t,e){function i(t,e){this.$form=t,this.options=e||{},this.fields={},this.bindEvents()}function s(e,i,s){this.name=e,this.options=s,this.$field=i,this.$container=i.closest(this.options.container||".form-group"),this.$message=this.options.message?this.getMessageElement():t(),this.$feedback=this.options.feedback?this.getFeedbackElement():t()}return i.prototype={defaults:{delay:300,rules:"",remoteRule:t.noop,triggers:["keyup","focusout","change"],message:!0,customMessages:{},feedback:!0,feedbackIcons:{success:'<i class="glyphicon glyphicon-check"></i>',error:'<i class="glyphicon glyphicon-remove"></i>'}},DominarField:s,bindEvents:function(){var t=this;this.$form.on("keyup blur change","textarea, input, select",function(e){t.fireValidate.call(t,e)}),this.$form.on("submit",function(){t.fireSubmit.call(t,event)})},getField:function(t){if("string"==typeof t)return this.fields[t];var e=t.attr("name"),i=this.fields[e];return!i&&this.options[e]&&(i=new this.DominarField(e,t,this.getOptions(e)),this.fields[e]=i,this.trigger("initField",i)),i},getOptions:function(e){var i=this.options[e];return t.extend({},this.defaults,i)},add:function(t,e){var i=this;return t.each(function(){i.options[this.name]=e}),this},trigger:function(t,e){this.$form.trigger("dominar."+t,[e])},fireValidate:function(e){var i=t(e.target),s=this.getField(i);if(s){var n=e.type,o="keyup"==n;(o&&9!==e.keyCode||!o)&&s.canTrigger(n)&&(o?this.validateDelayed(i):this.validate(i))}},fireSubmit:function(t){t.preventDefault(),this.validateAll(function(){t.target.submit()})},validate:function(t,e,i){var s=this.getField(t);s&&s.validate(e,i)},validateDelayed:function(t,e,i){var s=this.getField(t);s&&s.validateDelayed(e,i)},validateAll:function(e,i){var s,n,o=[];e=e||t.noop,i=i||t.noop;for(var a in this.options)n=t.Deferred(),s=this.getField(a)||this.getField(this.$form.find('[name="'+a+'"]')),o.push(n),function(t,e){t.validate(function(){e.resolve()},function(t){e.reject(t)})}(s,n);return t.when.apply(t,o).done(e).fail(i)}},i.register=function(t,i,s){e.register(t,i,s)},s.prototype={validate:function(e,i){var s=this.getName(),n=this.getValue(),o=this,a=t.Deferred();e=e||t.noop,i=i||t.noop,this.validator&&delete this.validator,this.validator=this.getValidator(),t.when(a,this.options.remoteRule(n)).done(function(){o.showSuccess(),e()}).fail(function(t){"string"!=typeof t&&(t=t.responseJSON.message),o.showError(t),i(t)}),!this.validator||this.validator.passes()?a.resolve():a.reject(this.validator.errors.first(s))},validateDelayed:function(e,i){var s=this,n=this.options.delay;e=e||t.noop,i=i||t.noop,clearTimeout(this.delayTimer),n?this.delayTimer=setTimeout(function(){s.validate.apply(s,[e,i])},n):this.validate(e,i)},getValidationOptions:function(){var t=this.getName(),e={},i={};e[t]=this.getValue(),i[t]=this.getRules(),0===i[t].length&&delete i[t];var s={data:e,rules:i,customMessages:this.options.customMessages};return this.options.validatorOptions&&(s=this.options.validatorOptions.call(this,s)),s},getValidator:function(){var t=this.getValidationOptions(),i=new e(t.data,t.rules,t.customMessages);return i},getRules:function(){return this.options.rules},getName:function(){return this.name},getValue:function(){return this.$field.val()},canTrigger:function(e){return t.isArray(this.options.triggers)?t.inArray(e,this.options.triggers)>-1:!1},$form:function(){return this.$container.closest("form")},getMessageElement:function(){var e=this.$container.find(".help-block");return 0===e.length&&(e=t('<span class="help-block"/>').insertAfter(this.$field)),e},getFeedbackElement:function(){var e=this.$container.find(".form-control-feedback");return 0===e.length&&(e=t('<span class="form-control-feedback"/>').insertAfter(this.$message.length?this.$message:this.$field)),e},showError:function(t){this.reset(),this.$container.addClass("has-error"),this.options.message&&this.$message.html(t||""),this.options.feedback&&this.showFeedback("error")},showSuccess:function(t){this.reset(),this.$container.addClass("has-success"),this.options.message&&this.$message.html(t||""),this.options.feedback&&this.showFeedback("success")},showFeedback:function(t){this.$container.addClass("has-feedback"),this.$feedback.html(this.options.feedbackIcons[t])},reset:function(){this.$container.removeClass("has-error has-success has-feedback"),this.$message.empty(),this.$feedback.empty()}},i});